#
# Executes commands at the start of an interactive session.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#

# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

# Customize to your needs...
[[ -f "$HOME/Local/source" ]] && source "$HOME/Local/source"

unsetopt correct

## THEME
export ZSH_THEME_GIT_PROMPT_DIRTY="%F{red}⚡%f"
export ZSH_THEME_GIT_AHEAD="↑"
export ZSH_THEME_GIT_DIVERGED="↕"
export ZSH_THEME_BEHIND="↓"

zstyle ':vcs_info:*' stagedstr ${ZSH_THEME_GIT_PROMPT_DIRTY}
zstyle ':vcs_info:*' unstagedstr ${ZSH_THEME_GIT_PROMPT_DIRTY}
zstyle ':vcs_info:*' formats '[%b%c%u]'
zstyle ':vcs_info:git*+set-message:*' hooks

PROMPT=$'%B%M%b %1d${vcs_info_msg_0_}%# '
RPROMPT=''

## tmux
#
# *Based on prezto tmux/init.zsh*
if [[ -z $DISPLAY && $XDG_VTNR -eq 1 ]]
then
  exec startx
else
  if [[ -z "$TMUX" && -z "$EMACS" && -z "$VIM" ]]
  then
    tmux start-server

    # Create a 'default' session if no session has been defined in tmux.conf.
    if ! tmux has-session 2> /dev/null; then
      tmux_session='default'
      tmux \
        new-session -d -s "$tmux_session" \; \
        set-option -t "$tmux_session" destroy-unattached off &> /dev/null
    fi

    # Attach to the 'default' session or to the last session used.
    exec tmux attach-session -t default
  fi
fi
